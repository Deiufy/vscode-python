name: '$(Year:yyyy).$(Month).0.$(BuildID)-ci'
# CI build.
# Notes: Only trigger a commit for master and release, and skip build/rebuild
#        on changes in the news and .vscode folders.
trigger:
  branches:
    include: ["master", "release", "pyui"]
  paths:
    exclude: ["/news/1 Enhancements", "/news/2 Fixes", "/news/3 Code Health", "/.vscode"]

# Not the PR build for merges to master and release.
pr: none

# Variables that are available for the entire pipeline.
variables:
  PythonVersion: '3.7'
  NodeVersion: '10.5.0'
  NpmVersion: 'latest'
  MOCHA_FILE: '$(Build.ArtifactStagingDirectory)/test-junit.xml' # All test files will write their JUnit xml output to this file, clobbering the last time it was written.
  MOCHA_REPORTER_JUNIT: true # Use the mocha-multi-reporters and send output to both console (spec) and JUnit (mocha-junit-reporter).
  VSC_PYTHON_FORCE_LOGGING: true # Enable this to turn on console output for the logger

jobs:
- job: Compile
  variables:
    Build: false
  pool:
    vmImage: "macos-10.13"
  steps:
    - template: templates/build.yml

- job: Build
  variables:
    Build: true
  pool:
    vmImage: "macos-10.13"
  steps:
    - template: templates/build.yml

- template: templates/uitest_jobs.yml
  parameters:
    jobs:
    - test: "Smoke"
      tags: "--tags=smoke"
    - test: "Test"
      tags: "--tags=test"
    - test: "Terminal"
      tags: "--tags=terminal"

